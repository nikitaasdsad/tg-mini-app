<!-- вставь этот файл как index.html -->
<!doctype html>
<html lang="ru">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Debug WebApp</title>
<style>body{font-family:Inter,Arial;margin:18px;color:#fff;background:#0f1113} .box{background:#121316;padding:12px;border-radius:8px} button{padding:8px 12px;margin-top:8px}</style>
</head>
<body>
  <h2>Тест WebApp</h2>
  <div class="box" id="info">Идёт проверка...</div>
  <div style="margin-top:12px">
    <button id="sendTest">Отправить тест-пейлоад в бот</button>
  </div>

<script>
const info = document.getElementById('info');
function update(msg){ info.innerHTML += '<div>'+msg+'</div>'; console.log(msg); }

update('window.Telegram: ' + (!!window.Telegram));
if(window.Telegram && Telegram.WebApp){
  update('Telegram.WebApp: OK');
  try{
    update('has initData: ' + !!Telegram.WebApp.initData);
    update('sendData type: ' + (typeof Telegram.WebApp.sendData));
    update('isExpanded: ' + !!Telegram.WebApp.isExpanded);
    update('version: ' + (Telegram.WebApp.version || 'unknown'));
  }catch(e){ update('Ошибка доступа к свойствам Telegram.WebApp: '+ e.message) }
} else {
  update('Telegram.WebApp не найден. Откройте мини-апп через бот (кнопка в чате).');
}

// Кнопка отправки тестового payload в бот
document.getElementById('sendTest').addEventListener('click', ()=>{
  const payload = JSON.stringify({ action: "rent", scenario_idx: 1 });
  update('Попытка отправить: ' + payload);
  if(window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.sendData === 'function'){
    try{
      Telegram.WebApp.sendData(payload);
      update('sendData вызван — закрою WebApp через 150ms');
      setTimeout(()=>{ try{ Telegram.WebApp.close(); }catch(e){ update('close error: '+e.message)} },150);
    }catch(e){
      update('Ошибка при sendData: ' + e.message);
    }
  } else {
    update('sendData не доступен. Откройте приложение ВНУТРИ Telegram именно через кнопку у бота.');
  }
});
</script>
</body>
</html>
