<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>–ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è</title>
<style>
  :root{--bg:#0f1113; --card:#121316; --muted:#bfc7cd; --accent:#2EA44F;}
  html,body{height:100%; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:var(--bg); color:#fff}
  .wrap{max-width:1100px; margin:12px auto; padding:12px;}
  .grid{display:grid; grid-template-columns:repeat(2,1fr); gap:12px;}
  @media(min-width:900px){ .grid{grid-template-columns:repeat(4,1fr);} }
  .card{border-radius:12px; overflow:hidden; position:relative; box-shadow:0 6px 20px rgba(0,0,0,0.6); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
  .thumb{width:100%; aspect-ratio:4/5; object-fit:cover; display:block}
  .overlay{position:absolute; left:0; right:0; bottom:0; padding:10px; transform:translateY(100%); transition:transform .22s;}
  .card:hover .overlay, .card.show-overlay .overlay{ transform:translateY(0%); }
  .title{font-weight:600; font-size:14px}
  .short{font-size:13px; color:var(--muted)}
  .btn{padding:8px 10px; border-radius:10px; border:0; cursor:pointer; font-weight:600}
  .btn.ghost{background:transparent; border:1px solid rgba(255,255,255,0.06)}
  .btn.primary{background:var(--accent); color:#06140a}
  .detail{display:none}
  .detail.active{display:block}
  .viewer{background:var(--card); border-radius:12px; padding:10px}
  .imgwrap{width:100%; height:min(62vh,700px); background:#000; display:flex; align-items:center; justify-content:center; border-radius:8px; overflow:hidden}
  .caption{color:var(--muted); margin-top:10px}
</style>
</head>
<body>
<div class="wrap">
  <header><h1>üìö –ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è</h1></header>

  <div id="mainView"><div class="grid" id="grid"></div></div>

  <div id="detailView" class="detail">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div id="detailTitle" style="font-weight:600">Title</div>
      <div>
        <button id="detailBack" class="btn ghost">üîô –ù–∞–∑–∞–¥</button>
        <button id="rentBtn" class="btn primary">–ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å</button>
      </div>
    </div>
    <div class="viewer">
      <div class="imgwrap"><img id="detailImg" src="" style="width:100%;height:100%;object-fit:cover"/></div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:10px">
        <button id="prevBtn" class="btn ghost">‚óÄÔ∏è</button>
        <button id="nextBtn" class="btn ghost">‚ñ∂Ô∏è</button>
      </div>
      <div id="pager" style="display:flex;gap:6px;justify-content:center;margin-top:8px"></div>
      <div class="caption" id="detailCaption"></div>
    </div>
  </div>
</div>

<script>
const ALL_SCENARIOS = [
  { title: "–í–∏–Ω—Ç–∞–∂–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç", short: "–ú—è–≥–∫–∏–π —Å–≤–µ—Ç, —Ç—ë–ø–ª—ã–µ —Ç–æ–Ω–∞.", caption: "–í–∏–Ω—Ç–∞–∂–Ω—ã–π –ø–æ—Ä—Ç—Ä–µ—Ç: ...", images:[
      "https://picsum.photos/seed/vintage1/1200/1600",
      "https://picsum.photos/seed/vintage2/1200/1600",
      "https://picsum.photos/seed/vintage3/1200/1600"
  ]},
  { title: "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≥–µ—Ä–æ–∏–Ω—è", short: "–Ø—Ä–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞ –∏ –ø–∏—Ä—Å–∏–Ω–≥.", caption: "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å: ...", images:[
      "https://picsum.photos/seed/alt1/1200/1600",
      "https://picsum.photos/seed/alt2/1200/1600",
      "https://picsum.photos/seed/alt3/1200/1600"
  ]},
  { title: "–ù–µ–æ–Ω–æ–≤—ã–π –∫–∏–±–µ—Ä–ø–∞–Ω–∫", short: "–ù–µ–æ–Ω, –¥–æ–∂–¥—å.", caption: "–ö–∏–±–µ—Ä–ø–∞–Ω–∫: ...", images:[
      "https://picsum.photos/seed/cyber1/1200/1600",
      "https://picsum.photos/seed/cyber2/1200/1600",
      "https://picsum.photos/seed/cyber3/1200/1600"
  ]},
  { title: "–ú–æ—Ä—Å–∫–æ–π –ø–æ—Ä—Ç—Ä–µ—Ç", short: "–í–µ—Ç–µ—Ä –≤ –≤–æ–ª–æ—Å–∞—Ö.", caption: "–ú–æ—Ä—Å–∫–æ–π –ø–æ—Ä—Ç—Ä–µ—Ç: ...", images:[
      "https://picsum.photos/seed/sea1/1200/1600",
      "https://picsum.photos/seed/sea2/1200/1600",
      "https://picsum.photos/seed/sea3/1200/1600"
  ]}
];

const grid = document.getElementById('grid');
const mainView = document.getElementById('mainView');
const detailView = document.getElementById('detailView');
const detailImg = document.getElementById('detailImg');
const detailTitle = document.getElementById('detailTitle');
const detailCaption = document.getElementById('detailCaption');
const pager = document.getElementById('pager');

let chosenListIndices = [], chosenList = [], currentGlobalIndex = null, currentScenarioIndex = 0, slideIndex = 0, slideshowTimer = null;

function pickRandomIndices(len, n){
  const arr = Array.from({length: len}, (_,i)=>i);
  const out = [];
  while(out.length < n && arr.length){
    const i = Math.floor(Math.random()*arr.length);
    out.push(arr.splice(i,1)[0]);
  }
  return out;
}

function renderMain(){
  grid.innerHTML = '';
  const take = Math.min(4, ALL_SCENARIOS.length);
  chosenListIndices = pickRandomIndices(ALL_SCENARIOS.length, take);
  chosenList = chosenListIndices.map(i=>ALL_SCENARIOS[i]);
  chosenList.forEach((sc, localIdx)=>{
    const card = document.createElement('div'); card.className='card';
    const img = document.createElement('img'); img.className='thumb'; img.src = sc.images[0];
    const overlay = document.createElement('div'); overlay.className='overlay';
    overlay.innerHTML = `<div class="title">${sc.title}</div><div class="short">${sc.short}</div>`;
    card.appendChild(img); card.appendChild(overlay);
    card.addEventListener('click', ()=> {
      if(window.innerWidth <= 900 && !card.classList.contains('show-overlay')){
        card.classList.add('show-overlay'); setTimeout(()=> card.classList.remove('show-overlay'), 3500); return;
      }
      openDetail(localIdx);
    });
    grid.appendChild(card);
  });
}

function openDetail(localIdx){
  currentScenarioIndex = localIdx; slideIndex = 0;
  currentGlobalIndex = chosenListIndices[localIdx];
  const sc = chosenList[localIdx];
  detailTitle.textContent = sc.title;
  detailCaption.textContent = sc.caption;
  detailImg.src = sc.images[slideIndex];
  renderPager(sc.images.length);
  mainView.style.display='none'; detailView.classList.add('active'); startSlideshow(); window.scrollTo({top:0,behavior:'smooth'});
}

function backToMain(){ stopSlideshow(); detailView.classList.remove('active'); mainView.style.display=''; }

function renderPager(len){ pager.innerHTML=''; for(let i=0;i<len;i++){ const d=document.createElement('div'); d.className='dot'+(i===slideIndex?' active':''); pager.appendChild(d);} }
function nextSlide(){ const sc = chosenList[currentScenarioIndex]; slideIndex = (slideIndex+1)%sc.images.length; detailImg.src = sc.images[slideIndex]; renderPager(sc.images.length); }
function prevSlide(){ const sc = chosenList[currentScenarioIndex]; slideIndex = (slideIndex-1+sc.images.length)%sc.images.length; detailImg.src = sc.images[slideIndex]; renderPager(sc.images.length); }
function startSlideshow(){ stopSlideshow(); slideshowTimer = setInterval(nextSlide, 5000); }
function stopSlideshow(){ if(slideshowTimer){ clearInterval(slideshowTimer); slideshowTimer=null; } }

document.getElementById('detailBack').addEventListener('click', backToMain);
document.getElementById('prevBtn').addEventListener('click', ()=>{ stopSlideshow(); prevSlide(); startSlideshow(); });
document.getElementById('nextBtn').addEventListener('click', ()=>{ stopSlideshow(); nextSlide(); startSlideshow(); });

/* RENT: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π payload (—Ç–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å). –õ–æ–≥–∏—Ä—É–µ–º –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º WebApp */
document.getElementById('rentBtn').addEventListener('click', ()=>{
  const payloadObj = { action: "rent", scenario_idx: currentGlobalIndex };
  const payloadStr = JSON.stringify(payloadObj);
  console.log("rent payload:", payloadStr);

  if(window.Telegram && Telegram.WebApp && typeof Telegram.WebApp.sendData === 'function'){
    try{
      Telegram.WebApp.sendData(payloadStr);
      detailTitle.textContent = "‚úÖ –°—Ü–µ–Ω–∞—Ä–∏–π –≤—ã–±—Ä–∞–Ω. –ó–∞–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.";
      setTimeout(()=> { try{ Telegram.WebApp.close(); } catch(e){ console.warn("close failed", e);} }, 150);
    } catch(e){
      console.error("sendData error", e);
      detailTitle.textContent = "–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
    }
  } else {
    console.log("Telegram.WebApp.sendData not available ‚Äî open inside Telegram client.");
    detailTitle.textContent = "–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram (–Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ).";
  }
});

if(window.Telegram && Telegram.WebApp){ try{ Telegram.WebApp.expand(); }catch(e){} try{ Telegram.WebApp.MainButton.hide(); }catch(e){} }

renderMain();
</script>
</body>
</html>
